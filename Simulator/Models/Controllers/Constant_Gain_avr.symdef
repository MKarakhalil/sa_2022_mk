%-------------------------------------------------------------------------- 
definitions: 
%-------------------------------------------------------------------------- 
dynamic_states x1=1
inputs VT=1 VREF=1 VPSS
external_states EFD=1
internal_states VF V1
events !ev_min !ev_max
parameters TR=0.001 KA=400 EFDMIN=-5.0 EFDMAX=5.0
%--------------------------------------------------------------------------
initializations: 
%-------------------------------------------------------------------------- 

%-------------------------------------------------------------------------- 
f_equations: 
%-------------------------------------------------------------------------- 
dt(x1) = 1/TR*(VT-x1) 
%-------------------------------------------------------------------------- 
g_equations: 
%-------------------------------------------------------------------------- 
g01 = V1 - KA*(VREF+VPSS-VF)
g02 = VF - x1 
%-------------------------------------------------------------------------- 
g03 = ev_min - (V1 - EFDMIN)
g04 = ev_max - (V1 - EFDMAX)
if t < 0
	g05 = EFD - V1
else
	if ev_min < 0
		g05 = EFD - EFDMIN
	else
		if ev_max > 0 
			g05 = EFD - EFDMAX
		else
			g05 = EFD - V1
		end 
	end 
end
%-------------------------------------------------------------------------- 
h_equations: 
%--------------------------------------------------------------------------

%-------------------------------------------------------------------------- 
measurements: 
%--------------------------------------------------------------------------

%-------------------------------------------------------------------------- 
checkparameters: 
%-------------------------------------------------------------------------- 
if ( TR == 0 )
    print(TR=ZERO not allowed, must STOP)
STOP 
end
%-------------------------------------------------------------------------- 
checklimits:
%-------------------------------------------------------------------------- 
if EFD > EFDMAX
    print((EFD=%d) larger than the upper limit (EFDMAX=%d),EFD,EFDMAX)
STOP
end

if EFD < EFDMIN
    print((EFD=%d) smaller than the lower limit (EFDMIN=%d),EFD,EFDMIN)
    STOP
end